<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL从安装到精通(二)---进阶篇 | 园游会</title><meta name="author" content="Xi17g3"><meta name="copyright" content="Xi17g3"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="(二)进阶篇By Xi17g3MySQL体系结构 储存引擎是存储数据、建立索引、更新&#x2F;查询数据等技术的实现方式。 #显示建表语句show create table account;#或者表上右键，查看DDL  CREATE TABLE &#96;account&#96; (  &#96;id&#96; int NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,  &#96;nam">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL从安装到精通(二)---进阶篇">
<meta property="og:url" content="http://youyuanhui123.github.io/2024/09/10/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%BA%8C-%E8%BF%9B%E9%98%B6%E7%AF%87/index.html">
<meta property="og:site_name" content="园游会">
<meta property="og:description" content="(二)进阶篇By Xi17g3MySQL体系结构 储存引擎是存储数据、建立索引、更新&#x2F;查询数据等技术的实现方式。 #显示建表语句show create table account;#或者表上右键，查看DDL  CREATE TABLE &#96;account&#96; (  &#96;id&#96; int NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,  &#96;nam">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://youyuanhui123.github.io/img/Xi17g3.jpg">
<meta property="article:published_time" content="2024-09-10T10:25:12.000Z">
<meta property="article:modified_time" content="2024-09-10T10:44:38.235Z">
<meta property="article:author" content="Xi17g3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://youyuanhui123.github.io/img/Xi17g3.jpg"><link rel="shortcut icon" href="/img/44ziyuan2-copy.png"><link rel="canonical" href="http://youyuanhui123.github.io/2024/09/10/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%BA%8C-%E8%BF%9B%E9%98%B6%E7%AF%87/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>(()=>{
      const saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
      
      window.btf = {
        saveToLocal: saveToLocal,
        getScript: (url, attr = {}) => new Promise((resolve, reject) => {
          const script = document.createElement('script')
          script.src = url
          script.async = true
          script.onerror = reject
          script.onload = script.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            script.onload = script.onreadystatechange = null
            resolve()
          }

          Object.keys(attr).forEach(key => {
            script.setAttribute(key, attr[key])
          })

          document.head.appendChild(script)
        }),

        getCSS: (url, id = false) => new Promise((resolve, reject) => {
          const link = document.createElement('link')
          link.rel = 'stylesheet'
          link.href = url
          if (id) link.id = id
          link.onerror = reject
          link.onload = link.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            link.onload = link.onreadystatechange = null
            resolve()
          }
          document.head.appendChild(link)
        }),

        addGlobalFn: (key, fn, name = false, parent = window) => {
          const pjaxEnable = false
          if (!pjaxEnable && key.startsWith('pjax')) return

          const globalFn = parent.globalFn || {}
          const keyObj = globalFn[key] || {}
    
          if (name && keyObj[name]) return
    
          name = name || Object.keys(keyObj).length
          keyObj[name] = fn
          globalFn[key] = keyObj
          parent.globalFn = globalFn
        }
      }
    
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode
      
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL从安装到精通(二)---进阶篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-10 18:44:38'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    btf.addGlobalFn('pjaxSend', () => { preloader.initLoading() }, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', () => { preloader.endLoading() }, 'preloader_end')
  }
})()</script><div id="web_bg" style="background-color: #59B1F5;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/laze.gif" data-original="/img/Xi17g3.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/image/miku.jpg);"><nav id="nav"><span id="blog-info"><a href="/" title="园游会"><span class="site-name">园游会</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQL从安装到精通(二)---进阶篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-09-10T10:25:12.000Z" title="发表于 2024-09-10 18:25:12">2024-09-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-10T10:44:38.235Z" title="更新于 2024-09-10 18:44:38">2024-09-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL从安装到精通(二)---进阶篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="二-进阶篇"><a href="#二-进阶篇" class="headerlink" title="(二)进阶篇"></a>(二)进阶篇</h1><h3 id="By-Xi17g3"><a href="#By-Xi17g3" class="headerlink" title="By Xi17g3"></a>By Xi17g3</h3><h2 id="MySQL体系结构"><a href="#MySQL体系结构" class="headerlink" title="MySQL体系结构"></a>MySQL体系结构</h2><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240710170523500.png" alt="image-20240710170523500"></p>
<h2 id="储存引擎"><a href="#储存引擎" class="headerlink" title="储存引擎"></a>储存引擎</h2><p>是存储数据、建立索引、更新&#x2F;查询数据等技术的实现方式。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#显示建表语句</span><br><span class="line">show create table account;</span><br><span class="line">#或者表上右键，查看DDL</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `account` (</span><br><span class="line">  `id` int NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br><span class="line">  `name` varchar(10) DEFAULT NULL COMMENT &#x27;姓名&#x27;,</span><br><span class="line">  `money` int DEFAULT NULL COMMENT &#x27;余额&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=&#x27;账号表&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#默认储存引擎</span><br><span class="line">ENGINE=InnoDB</span><br><span class="line">#自增，插入下一个数据的id为4</span><br><span class="line">AUTO_INCREMENT=4</span><br><span class="line">#当前表的字符集</span><br><span class="line">DEFAULT CHARSET=utf8mb4</span><br></pre></td></tr></table></figure>

<p>查看当前数据库支持的存储引擎</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show engines;</span><br></pre></td></tr></table></figure>

<h3 id="三种常见引擎的特点："><a href="#三种常见引擎的特点：" class="headerlink" title="三种常见引擎的特点："></a><strong>三种常见引擎的特点：</strong></h3><h4 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240710172418937.png" alt="image-20240710172418937"></p>
<p>查看data文件目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show global variables like &quot;%datadir%&quot;;</span><br><span class="line">#C:\ProgramData\MySQL\MySQL Server 8.0\Data\</span><br></pre></td></tr></table></figure>

<p>注意： </p>
<p>ProgramData 是隐藏文件 需要在控制面板-&gt;文件资源管理器选项-&gt; 查看-&gt;隐藏文件和文件夹-&gt;选中  显示隐藏的文件、文件夹和驱动器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看idb文件</span><br><span class="line">ibd2sdi account.ibd</span><br></pre></td></tr></table></figure>

<p>行-&gt;页-&gt;区-&gt;段-&gt;表空间</p>
<h4 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240710180201097.png" alt="image-20240710180201097"></p>
<h4 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240710180340125.png" alt="image-20240710180340125"></p>
<h4 id="三种引擎的区别"><a href="#三种引擎的区别" class="headerlink" title="三种引擎的区别"></a>三种引擎的区别</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240710180432444.png" alt="image-20240710180432444"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240710180647431.png" alt="image-20240710180647431"></p>
<h3 id="Linux配置MySQL"><a href="#Linux配置MySQL" class="headerlink" title="Linux配置MySQL"></a>Linux配置MySQL</h3><p>下载finalshell服务器：<a target="_blank" rel="noopener" href="http://www.hostbuf.com/">http://www.hostbuf.com/</a> </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46017623/article/details/130723343?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172217340316800185842211%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=172217340316800185842211&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-130723343-null-null.142">下载cent7并配置好，与final建立连接</a>，推荐GUI服务器或者GNOME桌面。</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240720165818283.png" alt="image-20240720165818283"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">问题<span class="number">1</span></span><br><span class="line">错误：无法创建 事务 锁定于 /var/lib/rpm/.rpm.lock (权限不够) </span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line">su切换为root模式</span><br><span class="line"></span><br><span class="line">问题<span class="number">2</span></span><br><span class="line">警告：mysql-community-client-plugins-<span class="number">8.0</span><span class="number">.26</span>-<span class="number">1.</span>el7.x86_64.rpm: 头V3 DSA/SHA256 Signature, 密钥 ID 5072e1f5: NOKEY</span><br><span class="line">错误：依赖检测失败：</span><br><span class="line">	libcrypto.so<span class="number">.10</span>()(64bit) 被 mysql-community-client-plugins-<span class="number">8.0</span><span class="number">.26</span>-<span class="number">1.</span>el7.x86_64 需要</span><br><span class="line">	libssl.so<span class="number">.10</span>()(64bit) 被 mysql-community-client-plugins-<span class="number">8.0</span><span class="number">.26</span>-<span class="number">1.</span>el7.x86_64 需要</span><br><span class="line">	</span><br><span class="line">解决方法：</span><br><span class="line">此条警告信息是因为yum安装了旧版本的gpg keys造成的。解决方法：给后缀添加<span class="string">&quot;–force --nodeps&quot;</span>即可。--nodeps --force</span><br></pre></td></tr></table></figure>

<p>下载Linux版本的Mysql</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240720205852005.png" alt="image-20240720205852005"></p>
<p>通过finalshell上传MySQL然后执行下面几条命令，出现报错请优先Google</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir mysql</span><br><span class="line">tar -xvf mysql-8.0.26-1.el7.x86_64.rpm-bundle\(1\).tar -C mysql</span><br></pre></td></tr></table></figure>

<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240720210104311.png" alt="image-20240720210104311"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[root@localhost Mysql]<span class="comment"># rpm -ivh mysql-community-common-8.0.26-1.el7.x86_64.rpm</span></span><br><span class="line">[root@localhost Mysql]<span class="comment"># rpm -ivh mysql-community-client-plugins-8.0.26-1.el7.x86_64.rpm --nodeps --force</span></span><br><span class="line">[root@localhost Mysql]<span class="comment"># rpm -ivh mysql-community-libs-8.0.26-1.el7.x86_64.rpm --nodeps --force</span></span><br><span class="line">[root@localhost Mysql]<span class="comment"># rpm -ivh mysql-community-libs-compat-8.0.26-1.el7.x86_64.rpm --nodeps --force</span></span><br><span class="line">[root@localhost Mysql]<span class="comment"># yum install openssl-devel</span></span><br><span class="line">[root@localhost Mysql]<span class="comment"># rpm -ivh mysql-community-devel-8.0.26-1.el7.x86_64.rpm --nodeps --force</span></span><br><span class="line">[root@localhost Mysql]<span class="comment"># rpm -ivh mysql-community-client-8.0.26-1.el7.x86_64.rpm --nodeps --force</span></span><br><span class="line">[root@localhost Mysql]<span class="comment"># rpm -ivh mysql-community-server-8.0.26-1.el7.x86_64.rpm --nodeps --force</span></span><br></pre></td></tr></table></figure>

<p>至此装配完毕</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#打开mysql服务：</span><br><span class="line">systemctl start mysqld</span><br><span class="line">#登陆mysql</span><br><span class="line">mysql -u root -p</span><br><span class="line">#查看密码</span><br><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br><span class="line">cat /var/log/mysqld.log</span><br><span class="line">得到密码：</span><br><span class="line">V(kFYEs9ZD&gt;:</span><br></pre></td></tr></table></figure>

<p>修改root密码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure>

<p>创建远程访问</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240720205202100.png" alt="image-20240720205202100"></p>
<p><strong>报错</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HY000][1130] null, message from server: &quot;Host &#x27;192.168.130.1&#x27; is not allowed to connect to this MySQL server&quot;.</span><br></pre></td></tr></table></figure>

<p>先root登陆mysql</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user set host=&#x27;%&#x27; where user=&#x27;root&#x27;;</span><br><span class="line">Grant all privileges on root.* to &#x27;root&#x27;@&#x27;%&#x27;;  #执行两次</span><br><span class="line">alter user root identified with mysql_native_password by &#x27;123456&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">show variables like &#x27;character%&#x27;; # 查看字符编码</span><br></pre></td></tr></table></figure>

<h2 id="索引-key"><a href="#索引-key" class="headerlink" title="索引(key)"></a>索引(key)</h2><h3 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h3><p><strong>什么是索引？</strong></p>
<p>是帮助MySQL高效获取数据的数据结构。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721114810137.png" alt="image-20240721114810137"></p>
<p><strong>索引的优缺点</strong></p>
<table>
<thead>
<tr>
<th align="center">优势</th>
<th align="center">劣势</th>
</tr>
</thead>
<tbody><tr>
<td align="center">提高数据检索的效率，降低数据库的IO成本</td>
<td align="center">索引列也是要占用空间的</td>
</tr>
<tr>
<td align="center">通过索引对列数据进行排序，降低数据排序的成本，降低CPU的消耗</td>
<td align="center">索引大大提高了查询效率，同时却也降低了更新表的速度，如对表进行INSERT、UPDATE、DELETE时</td>
</tr>
</tbody></table>
<h3 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721115908712.png" alt="image-20240721115908712"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721115923873.png" alt="image-20240721115923873"></p>
<p><strong>我们平常说的索引，如果没有特别指明，都是指B+树结构组织的索引。</strong></p>
<h4 id="B-Trees"><a href="#B-Trees" class="headerlink" title="B-Trees"></a>B-Trees</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721120636862.png" alt="image-20240721120636862"></p>
<p><strong>满足4key(5阶)即向上分裂</strong></p>
<h4 id="B-Trees-1"><a href="#B-Trees-1" class="headerlink" title="B+Trees"></a>B+Trees</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721123925882.png" alt="image-20240721123925882"></p>
<p><strong>所有的数都会存在于叶子结点，叶子节点形成一个单向列表</strong></p>
<p>MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加了一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高区间反问的性能。</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721124632587.png" alt="image-20240721124632587"></p>
<h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721144715677.png" alt="image-20240721144715677"></p>
<p>特点</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721144947525.png" alt="image-20240721144947525"></p>
<p><strong>为什么InnoDB存储引擎选择使用B+tree索引结构</strong></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721145302954.png" alt="image-20240721145302954"></p>
<h3 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721145440791.png" alt="image-20240721145440791"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721145735247.png" alt="image-20240721145735247"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721150010952.png" alt="image-20240721150010952"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from user where name=&#x27;Arm&#x27;;</span><br><span class="line">先查询二级索引，然后查询聚集索引</span><br></pre></td></tr></table></figure>

<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721150701984.png" alt="image-20240721150701984"></p>
<h3 id="索引语法"><a href="#索引语法" class="headerlink" title="索引语法"></a>索引语法</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721150903851.png" alt="image-20240721150903851"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#建表</span><br><span class="line">create table emp(</span><br><span class="line">	id int comment &#x27;编号&#x27;,</span><br><span class="line">	workno varchar(10) comment &#x27;工号&#x27;,</span><br><span class="line">	name varchar(10) comment &#x27;姓名&#x27;,</span><br><span class="line">	gender char(1) comment &#x27;性别&#x27;,</span><br><span class="line">	age tinyint unsigned comment &#x27;年龄&#x27;,</span><br><span class="line">	idcard varchar(18) comment &#x27;身份证号&#x27;,</span><br><span class="line">	workaddress varchar(50) comment &#x27;工作地址&#x27;,</span><br><span class="line">	entrydate date comment &#x27;入职时间&#x27;,</span><br><span class="line">	email varchar(10) comment &#x27;邮箱&#x27;</span><br><span class="line">) comment &#x27;员工表&#x27;;</span><br><span class="line">insert into emp (id,workno,name,gender,age,idcard,workaddress,entrydate,email) value</span><br><span class="line">(1,&#x27;1&#x27;,&#x27;柳岩&#x27;,&#x27;女&#x27;,20,&#x27;432121451523127859&#x27;,&#x27;北京&#x27;,&#x27;2000-01-01&#x27;,&#x27;1@2&#x27;),</span><br><span class="line">(2,&#x27;2&#x27;,&#x27;张无忌&#x27;,&#x27;男&#x27;,28,&#x27;432121451523127856&#x27;,&#x27;北京&#x27;,&#x27;2010-01-01&#x27;,&#x27;2@2&#x27;),</span><br><span class="line">(3,&#x27;3&#x27;,&#x27;韦一笑&#x27;,&#x27;男&#x27;,38,&#x27;432121451523127854&#x27;,&#x27;上海&#x27;,&#x27;2009-01-01&#x27;,&#x27;3@2&#x27;),</span><br><span class="line">(4,&#x27;4&#x27;,&#x27;赵敏&#x27;,&#x27;女&#x27;,18,&#x27;232121451523127854&#x27;,&#x27;北京&#x27;,&#x27;2008-01-01&#x27;,&#x27;4@2&#x27;),</span><br><span class="line">(5,&#x27;5&#x27;,&#x27;小招&#x27;,&#x27;女&#x27;,23,&#x27;433121451523127854&#x27;,&#x27;上海&#x27;,&#x27;2000-12-01&#x27;,&#x27;5@2&#x27;),</span><br><span class="line">(6,&#x27;6&#x27;,&#x27;杨上校&#x27;,&#x27;男&#x27;,88,&#x27;432121451523127554&#x27;,&#x27;北京&#x27;,&#x27;1998-01-20&#x27;,&#x27;6@2&#x27;),</span><br><span class="line">(7,&#x27;7&#x27;,&#x27;哈哈&#x27;,&#x27;女&#x27;,18,&#x27;432121455523127854&#x27;,&#x27;长沙&#x27;,&#x27;1988-01-01&#x27;,&#x27;7@2&#x27;),</span><br><span class="line">(8,&#x27;8&#x27;,&#x27;柳如烟&#x27;,&#x27;女&#x27;,88,&#x27;432121477773127854&#x27;,&#x27;西安&#x27;,&#x27;1978-01-01&#x27;,&#x27;8@2&#x27;),</span><br><span class="line">(9,&#x27;9&#x27;,&#x27;大壮&#x27;,&#x27;男&#x27;,29,&#x27;432121451529927854&#x27;,&#x27;江苏&#x27;,&#x27;2012-01-01&#x27;,&#x27;9@2&#x27;),</span><br><span class="line">(10,&#x27;10&#x27;,&#x27;刘马&#x27;,&#x27;男&#x27;,66,&#x27;433333451523127854&#x27;,&#x27;永州&#x27;,&#x27;2009-08-01&#x27;,&#x27;10@2&#x27;),</span><br><span class="line">(11,&#x27;11&#x27;,&#x27;新来的&#x27;,&#x27;女&#x27;,29,&#x27;702121451523127854&#x27;,&#x27;郴州&#x27;,&#x27;2024-07-02&#x27;,&#x27;11@2&#x27;);</span><br></pre></td></tr></table></figure>

<p>创建索引</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--1、name为姓名字段，该字段的值可能会重复，为该字段创建索引。</span><br><span class="line">create index idx_emp_name on emp(name);</span><br><span class="line">--2、idcard身份证号字段的值是非空的，且唯一的，为该字段创建唯一索引。</span><br><span class="line">create unique index idx_emp_idcard on emp(idcard);</span><br><span class="line">--3、为entrydate、age、workaddress创建联合索引。</span><br><span class="line">create index idx_emp_ent_age_workddr on emp(entrydate,age,workaddress);</span><br><span class="line">--4、为email建立合适的索引来提升查询效率</span><br><span class="line">create index idx_emp_email on emp(email);</span><br></pre></td></tr></table></figure>

<h3 id="SQL性能分析"><a href="#SQL性能分析" class="headerlink" title="SQL性能分析"></a>SQL性能分析</h3><h4 id="SQL执行频率"><a href="#SQL执行频率" class="headerlink" title="SQL执行频率"></a>SQL执行频率</h4><p>查看当前数据库的INSERT、UPDATE、DELETE、SELECT的访问频次：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show global status like &#x27;Com_______&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721162055738.png" alt="image-20240721162055738"></p>
<h4 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h4><p><strong>记录了所有执行时间超过指定参数(默认10秒)的所有SQL语句的日志。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables like &#x27;slow_query_log&#x27;;</span><br><span class="line">#默认没有开启</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line">#慢查询日志</span><br><span class="line">slow_query_log=1</span><br><span class="line"></span><br><span class="line">slow_query_time=5</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看慢日志文件</span><br><span class="line">cd /var/lib/mysql</span><br><span class="line">cat localhost-slow.log</span><br></pre></td></tr></table></figure>

<p><strong>cat &#x2F;var&#x2F;log&#x2F;mysqld.log | grep ERROR #只查看具体的报错日志，省略了其他类型的日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /var/lib/mysql</span><br><span class="line">#查看慢日志文件尾部实时输出的内容</span><br><span class="line">tail -f localhost-slow.log</span><br></pre></td></tr></table></figure>

<h4 id="profile详情"><a href="#profile详情" class="headerlink" title="profile详情"></a>profile详情</h4><p>通过show profiles能够帮助我们了解时间损耗都到哪里去了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#通过have_profiling参数，能够看到当前MySQL是否支持profile操作</span><br><span class="line">select @@have_profiling;</span><br><span class="line">#查看profiling是否支持,默认不支持</span><br><span class="line">select @@profiling</span><br><span class="line">set @@profiling=1;</span><br></pre></td></tr></table></figure>

<p>经过一系列的业务SQL的操作，然后通过如下指令查看当前指令的耗时情况</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看每一条SQL的耗时基本情况</span><br><span class="line">show profiles;</span><br><span class="line">#查看指定query_id的SQL语句各个阶段的耗时情况</span><br><span class="line">show profile for query query_id;</span><br><span class="line">#查看指定query_id的SQL语句CPU的使用情况</span><br><span class="line">show profile cpu for query query_id;</span><br></pre></td></tr></table></figure>

<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721172947005.png" alt="image-20240721172947005"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721173137974.png" alt="image-20240721173137974"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721173219649.png" alt="image-20240721173219649"></p>
<h4 id="explain执行计划"><a href="#explain执行计划" class="headerlink" title="explain执行计划"></a>explain执行计划</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">explain + [select语句]</span><br><span class="line">explain select * from emp where id=1;</span><br></pre></td></tr></table></figure>

<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240721173727020.png" alt="image-20240721173727020"></p>
<h3 id="索引使用"><a href="#索引使用" class="headerlink" title="索引使用"></a>索引使用</h3><h4 id="验证索引效率"><a href="#验证索引效率" class="headerlink" title="验证索引效率"></a>验证索引效率</h4><p><strong>在未建立索引之前，先执行SQL语句，查看SQL的耗时。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from emp where id=1\G;</span><br></pre></td></tr></table></figure>

<h4 id="针对字段创建索引"><a href="#针对字段创建索引" class="headerlink" title="针对字段创建索引"></a><strong>针对字段创建索引</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create index idx_emp on emp(id);</span><br><span class="line">#再次执行</span><br><span class="line">select * from emp where id=1\G;</span><br><span class="line">#发现建立了索引之后时间大大缩小</span><br></pre></td></tr></table></figure>

<h4 id="最左前缀法则"><a href="#最左前缀法则" class="headerlink" title="最左前缀法则"></a><strong>最左前缀法则</strong></h4><p><strong>创建索引</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create index idx_user_pro_age_sta on tb_user(profession,age,status)</span><br></pre></td></tr></table></figure>

<p><strong>若最左边的列不存在，则索引失效，如果跳过某一列，索引将部分失效</strong></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240723130413326.png" alt="image-20240723130413326"></p>
<h4 id="索引失效"><a href="#索引失效" class="headerlink" title="索引失效"></a>索引失效</h4><h5 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h5><p><strong>出现范围查询时(&lt;,&gt;),右侧的列索引失效</strong></p>
<p>规避方法，用(&#x3D;&gt;,&lt;&#x3D;)</p>
<h5 id="索引列运算"><a href="#索引列运算" class="headerlink" title="索引列运算"></a>索引列运算</h5><p>不要在索引列上进行运算操作，索引将失效。</p>
<h5 id="字符串不加引号"><a href="#字符串不加引号" class="headerlink" title="字符串不加引号"></a>字符串不加引号</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240723132050913.png" alt="image-20240723132050913"></p>
<h5 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#后面模糊，走索引</span><br><span class="line">select * from tb_user where like &#x27;软件%&#x27;;</span><br><span class="line">#前面模糊，不走索引</span><br><span class="line">select * from tb_user where like &#x27;%工程&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="or连接的条件"><a href="#or连接的条件" class="headerlink" title="or连接的条件"></a>or连接的条件</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240723132751939.png" alt="image-20240723132751939"></p>
<h5 id="数据分布影响"><a href="#数据分布影响" class="headerlink" title="数据分布影响"></a>数据分布影响</h5><p>如果MySQL评估使用索引比全表更慢，则不使用索引</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#小部分，走索引</span><br><span class="line">select * from tb_user where phone&gt;=&#x27;17799990020&#x27;;</span><br><span class="line">#全表扫描</span><br><span class="line">select * from tb_user where phone&gt;=&#x27;17799990000&#x27;;</span><br><span class="line">#小部分，走索引</span><br><span class="line">select * from tb_user where phone&gt;=&#x27;17799990014&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="SQL提示"><a href="#SQL提示" class="headerlink" title="SQL提示"></a>SQL提示</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240723152752599.png" alt="image-20240723152752599"></p>
<h4 id="覆盖索引-回表查询"><a href="#覆盖索引-回表查询" class="headerlink" title="覆盖索引&amp;回表查询"></a>覆盖索引&amp;回表查询</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240723201351891.png" alt="image-20240723201351891"></p>
<p><strong>回表：先二级索引查，所得结果去聚集索引查</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#id--&gt;聚集索引 name--&gt;二级索引</span><br><span class="line"></span><br><span class="line">select from tb_user where id=2;</span><br><span class="line">#覆盖索引</span><br><span class="line">select id,name from tb_user where name=&#x27;Arm&#x27;;</span><br><span class="line">#无覆盖索引，gender需回表</span><br><span class="line">select id,name,gender from tb_user where name=&#x27;Arm&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240723211343242.png" alt="image-20240723211343242"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create index idx_email_5 on tb_user (email(5));</span><br></pre></td></tr></table></figure>

<h4 id="单列索引与联合索引"><a href="#单列索引与联合索引" class="headerlink" title="单列索引与联合索引"></a>单列索引与联合索引</h4><p><strong>创建联合索引</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create unique index idx_user_phone_name on tb_user(phone,name);</span><br></pre></td></tr></table></figure>

<p>如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单列索引，因为单列容易回表。</p>
<h3 id="索引设计原则"><a href="#索引设计原则" class="headerlink" title="索引设计原则"></a>索引设计原则</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240723212304402.png" alt="image-20240723212304402"></p>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><h4 id="insert优化"><a href="#insert优化" class="headerlink" title="insert优化"></a>insert优化</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240725161916571.png" alt="image-20240725161916571"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240725162228984.png" alt="image-20240725162228984"></p>
<p>load_user_100w_sort.sql文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看文件行数</span><br><span class="line">wc -l load_user_100w_sort.sql</span><br><span class="line">#查看前十行内容</span><br><span class="line">head load_user_100w_sort.sql</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看当前路径</span><br><span class="line">pwd</span><br><span class="line">#/home/xi17g3/load_user_100w_sort.sql</span><br></pre></td></tr></table></figure>

<p>先建表</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table emp(</span><br><span class="line">    id         int auto_increment comment &#x27;编号&#x27; primary key,</span><br><span class="line">    workno      varchar(10)       comment &#x27;工号&#x27;,</span><br><span class="line">    name        varchar(10)       comment &#x27;姓名&#x27;,</span><br><span class="line">    gender      char              comment &#x27;性别&#x27;,</span><br><span class="line">    age         tinyint unsigned  comment &#x27;年龄&#x27;,</span><br><span class="line">    idcard      varchar(18)       comment &#x27;身份证号&#x27;,</span><br><span class="line">    workaddress varchar(50)       comment &#x27;工作地址&#x27;,</span><br><span class="line">    entrydate   date              comment &#x27;入职时间&#x27;,</span><br><span class="line">    job         varchar(10)       comment &#x27;工作&#x27;,</span><br><span class="line">    salary      int               comment &#x27;工资&#x27;,</span><br><span class="line">    leaderid	int	              comment &#x27;所属领导&#x27;,</span><br><span class="line">    salgrade_grade int            comment &#x27;工资等级&#x27;,</span><br><span class="line">    dept_id     int               comment &#x27;部门号&#x27;</span><br><span class="line">)</span><br><span class="line">    comment &#x27;员工表&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">load data local infile &#x27;/home/xi17g3/load_user_100w_sort.sql&#x27; into table emp fields terminated by &#x27;,&#x27; lines terminated</span><br><span class="line"> by &#x27;\n&#x27;;</span><br></pre></td></tr></table></figure>

<p><strong>会有效减少大量数据插入时间</strong></p>
<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><p><strong>主键乱序插入</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1,5,9,23,47,55,67,89,101,107,50</span><br></pre></td></tr></table></figure>

<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240725170348296.png" alt="image-20240725170348296"></p>
<p>删除13,14,15,16</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240725171737156.png" alt="image-20240725171737156"></p>
<h3 id="order-by优化"><a href="#order-by优化" class="headerlink" title="order by优化"></a>order by优化</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240727124832576.png" alt="image-20240727124832576"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#创建age和phone的索引</span><br><span class="line">create index idx_user_age_pho on tb_user(age,phone);</span><br><span class="line">#默认排序方式为升序asc</span><br><span class="line"></span><br><span class="line">#如需查询 (age asc phone desc)，则需要另创建索引，否则不会走索引</span><br><span class="line">create index idx_user_age_pho_ad on tb_user(age asc ,phone desc);</span><br></pre></td></tr></table></figure>

<h3 id="group-by优化"><a href="#group-by优化" class="headerlink" title="group by优化"></a>group by优化</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240727132933439.png" alt="image-20240727132933439"></p>
<h3 id="limit优化"><a href="#limit优化" class="headerlink" title="limit优化"></a>limit优化</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240727133524301.png" alt="image-20240727133524301"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#从第0个位置开始，查找后面十条记录</span><br><span class="line">select * from tb_sku limit 0,10</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select s.* from tb_sku s , (select id from tb_sku order by id limit 90000,10) a where s.id=a.id;</span><br></pre></td></tr></table></figure>

<h3 id="count优化"><a href="#count优化" class="headerlink" title="count优化"></a>count优化</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240727133842742.png" alt="image-20240727133842742"></p>
<p><strong>count的四种使用方法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#count*，不取值，服务层直接按行进行累加</span><br><span class="line">select count(*) from tb_user;</span><br><span class="line">#count主键，直接进行累加，主键不存在null</span><br><span class="line">select count(id) from tb_user;</span><br><span class="line">#count字段,count不计数null值</span><br><span class="line">select count(profession) from tb_user;</span><br><span class="line">#count(1)，直接按行进行累加</span><br><span class="line">select count(1) from tb_user;</span><br></pre></td></tr></table></figure>

<p><strong>按照效率排序</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">count(字段)&lt;count(主键id)&lt;count(1)~count(*)，所以尽量使用count(*).</span><br></pre></td></tr></table></figure>

<h3 id="update优化-避免行锁"><a href="#update优化-避免行锁" class="headerlink" title="update优化(避免行锁)"></a>update优化(避免行锁)</h3> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">窗口1</span><br><span class="line">begin;</span><br><span class="line">update ... where id=1;</span><br><span class="line">commit;</span><br><span class="line">窗口2</span><br><span class="line">brgin;</span><br><span class="line">update ... where id=1;</span><br><span class="line">commit;</span><br><span class="line">二者同时发生，正常执行</span><br><span class="line"></span><br><span class="line">#发生表锁的情况</span><br><span class="line">begin;</span><br><span class="line">update course set name = &#x27;Kafka2&#x27; where name =&#x27;PHP&#x27;;</span><br><span class="line">因为PHP未建立索引，故会直接锁住该表</span><br><span class="line">#建立索引</span><br><span class="line">create index idx_course_name on course(name);</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240727142545211.png" alt="image-20240727142545211"></p>
<h2 id="视图-存储过程-触发器"><a href="#视图-存储过程-触发器" class="headerlink" title="视图&#x2F;存储过程&#x2F;触发器"></a>视图&#x2F;存储过程&#x2F;触发器</h2><h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p><strong>虚拟存在的一个表</strong></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240727144824506.png" alt="image-20240727144824506"></p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#创建视图</span><br><span class="line">create or replace view emp_v_1 as select id,name from emp where id &lt;=20;</span><br></pre></td></tr></table></figure>

<h4 id="检查选项"><a href="#检查选项" class="headerlink" title="检查选项"></a>检查选项</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">insert into emp_v_1 values(5,&#x27;Tom&#x27;);</span><br><span class="line">insert into emp_v_1 values(30,&#x27;Tom&#x27;);</span><br><span class="line">5,Tom会显示，30,Tom不会显示，但二者都会插入到emp表中</span><br><span class="line">#添加条件检查</span><br><span class="line">create or replace view emp_v_1 as select id,name from emp where id &lt;=20 with cascaded check option;</span><br></pre></td></tr></table></figure>

<p><strong>cascaded(独立)</strong></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240730202938533.png" alt="image-20240730202938533"></p>
<p><strong>local(递归)</strong></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240730203616199.png" alt="image-20240730203616199"></p>
<h4 id="更新及作用"><a href="#更新及作用" class="headerlink" title="更新及作用"></a>更新及作用</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240811184618618.png" alt="image-20240811184618618"></p>
<p>如果视图使用了函数则无法进行更新操作</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240812111139813.png" alt="image-20240812111139813"></p>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240812124647864.png" alt="image-20240812124647864"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--1、</span><br><span class="line">create view tb_user_view as select id,name,profession,age,gender,status,createtime from tb_user;</span><br><span class="line">select * from tb_user_view;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--2、</span><br><span class="line">create view tb_stu_course_view as select s.name,s.no,c.name from student s,student_course sc,course c where s.id=sc.studentid and sc.courseid=c.id;</span><br><span class="line">select * from tb_stu_course_view;</span><br></pre></td></tr></table></figure>

<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240812141116716.png" alt="image-20240812141116716"></p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">封装，复用</span><br><span class="line">可以接收参数，也可以返回数据</span><br><span class="line">减少网络交互，效率提升</span><br></pre></td></tr></table></figure>

<h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240812141314367.png" alt="image-20240812141314367"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#创建</span><br><span class="line">create procedure p1()</span><br><span class="line">begin</span><br><span class="line">	select count(*) from student;</span><br><span class="line">end;</span><br><span class="line">#调用</span><br><span class="line">call p1();</span><br><span class="line">#查看</span><br><span class="line">select * from information_schema.routines where routine_schema=&#x27;hhh&#x27;;</span><br><span class="line"></span><br><span class="line">show create procedure p1;</span><br><span class="line">#删除</span><br><span class="line">drop procedure if exists p1;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<p>在命令行中，执行创建存储过程的SQL时，需要通过关键字delimiter指定SQL语句的结束符，以避免冲突。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">delimiter $</span><br></pre></td></tr></table></figure>

<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><h5 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240812153439862.png" alt="image-20240812153439862"></p>
<h5 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240812153720497.png" alt="image-20240812153720497"></p>
<h5 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240812154159591.png" alt="image-20240812154159591"></p>
<h4 id="if判断"><a href="#if判断" class="headerlink" title="if判断"></a>if判断</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if 条件1 then</span><br><span class="line">...</span><br><span class="line">else 条件2 then</span><br><span class="line">...</span><br><span class="line">else</span><br><span class="line">...</span><br><span class="line">end if;</span><br></pre></td></tr></table></figure>

<p>例</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create procedure p3()</span><br><span class="line">begin</span><br><span class="line">	declare score int default 58;</span><br><span class="line">	declare result varchar(10);</span><br><span class="line">	</span><br><span class="line">	if score &gt;=85 then</span><br><span class="line">		set result := &#x27;优秀&#x27;;</span><br><span class="line">	elseif score &gt;=60 then</span><br><span class="line">		set result := &#x27;及格&#x27;;</span><br><span class="line">	else</span><br><span class="line">		set result := &#x27;不及格&#x27;;</span><br><span class="line">	end if;</span><br><span class="line">	select result;</span><br><span class="line">	</span><br><span class="line">end;	</span><br><span class="line"></span><br><span class="line">#调用存储过程</span><br><span class="line">call p3();</span><br></pre></td></tr></table></figure>

<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">in 输入	out	输出	inout 既可输入也可输出</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create procedure p4(in score int,out result varchar(10))</span><br><span class="line">begin</span><br><span class="line">	declare score int default 58;</span><br><span class="line">	declare result varchar(10);</span><br><span class="line">	</span><br><span class="line">	if score &gt;=85 then</span><br><span class="line">		set result := &#x27;优秀&#x27;;</span><br><span class="line">	elseif score &gt;=60 then</span><br><span class="line">		set result := &#x27;及格&#x27;;</span><br><span class="line">	else</span><br><span class="line">		set result := &#x27;不及格&#x27;;</span><br><span class="line">	end if;</span><br><span class="line">	select result;</span><br><span class="line">end;	</span><br><span class="line"></span><br><span class="line">#调用存储过程</span><br><span class="line">call p4(68,@result);</span><br><span class="line">select @result;</span><br></pre></td></tr></table></figure>

<p>将传入的200分制的分数，进行换算，换算成百分制，然后返回分数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create procedure p5(inout score double)</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line"></span><br><span class="line">	set score :=sore*0.5;</span><br><span class="line"></span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">set @score=78;</span><br><span class="line">call p5(@score);</span><br><span class="line">select @score;</span><br></pre></td></tr></table></figure>

<h4 id="case"><a href="#case" class="headerlink" title="case"></a>case</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240824152341795.png" alt="image-20240824152341795"></p>
<p>案例</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240824152437939.png" alt="image-20240824152437939"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create procedure p6(in month int)</span><br><span class="line">begin</span><br><span class="line">	declare result varchar(10);</span><br><span class="line"></span><br><span class="line">	case</span><br><span class="line">		when month &gt;=1 and month &lt;=3 then</span><br><span class="line">			set result := &#x27;第一季度&#x27;;</span><br><span class="line">		when month &gt;=4 and month &lt;=6 then</span><br><span class="line">			set result := &#x27;第二季度&#x27;;</span><br><span class="line">		when month &gt;=7 and month &lt;=9 then</span><br><span class="line">			set result := &#x27;第三季度&#x27;;</span><br><span class="line">		when month &gt;=10 and month &lt;=12 then</span><br><span class="line">			set result := &#x27;第四季度&#x27;;</span><br><span class="line">		else</span><br><span class="line">			set result := &#x27;非法参数&#x27;;</span><br><span class="line">	end case;</span><br><span class="line">	select concat(&#x27;您输入的月份为：&#x27;,month, &#x27; 所属季度为：&#x27;,result);</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p6(13);</span><br></pre></td></tr></table></figure>

<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><h5 id="while"><a href="#while" class="headerlink" title="while"></a>while</h5><p>计算从1累加到n的值，n为传入的参数值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create procedure p7(in n int)</span><br><span class="line">begin</span><br><span class="line">	declare total int default 0;</span><br><span class="line">	while n&gt;0 do</span><br><span class="line">		set total := totol+n;</span><br><span class="line">		set n :=n-1;</span><br><span class="line">	end while;</span><br><span class="line">	</span><br><span class="line">	select total;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p7(100);</span><br></pre></td></tr></table></figure>

<h5 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h5><p>repeat是有条件的循环控制语句。当满足条件的时候退出循环</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create procedure p8(in n int)</span><br><span class="line">begin</span><br><span class="line">	declare total int default 0;</span><br><span class="line">	repeat</span><br><span class="line">		set total := total+n;</span><br><span class="line">		set n := n-1;</span><br><span class="line">	    until n &lt;=0</span><br><span class="line">	end repeat;</span><br><span class="line">	select total;</span><br><span class="line">end;</span><br><span class="line">call p8(100)</span><br></pre></td></tr></table></figure>

<h5 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240824170359590.png" alt="image-20240824170359590"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--1、计算从1累加到n的值，n为传入的参数值。</span><br><span class="line">create procedure p9(in n int)</span><br><span class="line">begin</span><br><span class="line">	declare total int default 0;</span><br><span class="line">	</span><br><span class="line">	sum:loop</span><br><span class="line">		if n&lt;=0 then</span><br><span class="line">			leave sum;</span><br><span class="line">		end if;</span><br><span class="line">		</span><br><span class="line">		set total :=total+n;</span><br><span class="line">		set n := n-1;</span><br><span class="line">	end loop sum;</span><br><span class="line"></span><br><span class="line">	select total;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">--2、计算聪1到n之间的偶数累加的值，n为传入的参数值。</span><br><span class="line">create procedure p10(in n int)</span><br><span class="line">begin</span><br><span class="line">	declare total int default 0;</span><br><span class="line"></span><br><span class="line">	sum:loop</span><br><span class="line">		if n&lt;=0 then</span><br><span class="line">			leave sum;</span><br><span class="line">		end if;</span><br><span class="line"></span><br><span class="line">		if n%2=1 then</span><br><span class="line">			set n := n-1;</span><br><span class="line">			iterate sum;</span><br><span class="line">		end if;</span><br><span class="line"></span><br><span class="line">		set total :=total+n;</span><br><span class="line">		set n := n-1;</span><br><span class="line">	end loop sum;</span><br><span class="line"></span><br><span class="line">	select total;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p9(10);</span><br><span class="line">call p10(10);</span><br></pre></td></tr></table></figure>

<h5 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240902205203501.png" alt="image-20240902205203501"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">请完成如下需求：</span><br><span class="line">根据传入的参数uage，来查询用户表tb_user中，所有的用户年龄小于等于uage的用户姓名(name)和专业(profession)，并将用户的姓名和专业插入到所创建的一张新表(id,name,profession)中。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#运行会报错</span><br><span class="line">create procedure p11(in uage int)</span><br><span class="line">begin</span><br><span class="line">	declare uname varchar(100);</span><br><span class="line">	declare upro varchar(100);</span><br><span class="line">	declare u_cursor cursor for select name,profession from tb_user where age &lt;=age;</span><br><span class="line"></span><br><span class="line">	drop table if exists tb_user_pro;</span><br><span class="line">	create table if not exists tb_user_pro(</span><br><span class="line">		id int primary key auto_increment,</span><br><span class="line">		name varchar(100),</span><br><span class="line">		profession varchar(100)</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	open u_cursor;</span><br><span class="line">	while ture do</span><br><span class="line">		fetch u_cursor into uname,upro;</span><br><span class="line">		insert into tb_user_pro values(null,name,upro);</span><br><span class="line">	end while;</span><br><span class="line">	close u_cousor;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p11(40);</span><br></pre></td></tr></table></figure>

<h5 id="条件处理程序"><a href="#条件处理程序" class="headerlink" title="条件处理程序"></a>条件处理程序</h5><p>解决上条问题</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240902214905649.png" alt="image-20240902214905649"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#运行会报错</span><br><span class="line">create procedure p11(in uage int)</span><br><span class="line">begin</span><br><span class="line">	declare uname varchar(100);</span><br><span class="line">	declare upro varchar(100);</span><br><span class="line">	declare u_cursor cursor for select name,profession from tb_user where age &lt;=age;</span><br><span class="line">	declare exit handler for SQLSTATE &#x27;02000&#x27; close u_cursor;</span><br><span class="line"></span><br><span class="line">	drop table if exists tb_user_pro;</span><br><span class="line">	create table if not exists tb_user_pro(</span><br><span class="line">		id int primary key auto_increment,</span><br><span class="line">		name varchar(100),</span><br><span class="line">		profession varchar(100)</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	open u_cursor;</span><br><span class="line">	while ture do</span><br><span class="line">		fetch u_cursor into uname,upro;</span><br><span class="line">		insert into tb_user_pro values(null,name,upro);</span><br><span class="line">	end while;</span><br><span class="line">	close u_cousor;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p11(40);</span><br></pre></td></tr></table></figure>

<h4 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h4><p>使用相对较少</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240905185759957.png" alt="image-20240905185759957"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#计算从1开始的累加和</span><br><span class="line">create function fun1(n int)</span><br><span class="line">returns int deterministic</span><br><span class="line">begin</span><br><span class="line">	declare total int default 0;</span><br><span class="line">	while n&gt;0 do</span><br><span class="line">		set total :=total+n;</span><br><span class="line">		set n :=n-1;</span><br><span class="line">	end while;</span><br><span class="line">	return total;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">select fun1(200);</span><br></pre></td></tr></table></figure>

<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240905190359160.png" alt="image-20240905190359160"></p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240905190530818.png" alt="image-20240905190530818"></p>
<h4 id="insert类型"><a href="#insert类型" class="headerlink" title="insert类型"></a>insert类型</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240906195256911.png" alt="image-20240906195256911"></p>
<p>插入数据触发器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create trigger tb_user_insert_trigger</span><br><span class="line">	after insert on tb_user for each row</span><br><span class="line">begin</span><br><span class="line"></span><br><span class="line">	insert into user_Logs(id,operation,operate_time,operate_id,operate_params) VALUES</span><br><span class="line"></span><br><span class="line">	(null,&#x27;insert&#x27;,now(),new.id,</span><br><span class="line">     	concat(&#x27;插入的数据内容为: id=&#x27;new.id,&#x27;,name=&#x27;new.name,&#x27;,phone=&#x27;,NEW.phone,&#x27;,email=&#x27;,NEW.email,&#x27;,profession=&#x27;,NEW.profession));</span><br><span class="line">	</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">#查看触发器</span><br><span class="line">show triggers;</span><br><span class="line">#删除触发器</span><br><span class="line">drop trigger tb_user_insert_trigger;</span><br></pre></td></tr></table></figure>

<p>插入数据到tb_user</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">insert into tb_user(id,name,phone,email,profession,age,gender,status,createtime) VALUES (25,&#x27;二皇子&#x27;,188754645....)</span><br></pre></td></tr></table></figure>

<p>查询日志表可以看到相关插入信息</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907170649350.png" alt="image-20240907170649350"></p>
<h4 id="update类型"><a href="#update类型" class="headerlink" title="update类型"></a>update类型</h4><p>修改数据触发器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create trigger tb_user_insert_trigger</span><br><span class="line">							   #行级触发器</span><br><span class="line">	after insert on tb_user for each row</span><br><span class="line">begin</span><br><span class="line"></span><br><span class="line">	insert into user_Logs(id,operation,operate_time,operate_id,operate_params) VALUES</span><br><span class="line"></span><br><span class="line">	(null,&#x27;update&#x27;,now(),new.id,</span><br><span class="line">		concat(&#x27;更新之前的数据内容为: id=&#x27;old.id,&#x27;,name=&#x27;old.name,&#x27;,phone=&#x27;,old.phone,&#x27;,email=&#x27;,old.email,&#x27;,profession=&#x27;,old.profession</span><br><span class="line">			&#x27; | 更新之后的数据内容为: id=&#x27;new.id,&#x27;,name=&#x27;new.name,&#x27;,phone=&#x27;,NEW.phone,&#x27;,email=&#x27;,NEW.email,&#x27;,profession=&#x27;,NEW.profession));</span><br><span class="line">	</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">#查看触发器</span><br><span class="line">show triggers;</span><br><span class="line"></span><br><span class="line">update tb_user set age = 32 where id=23;</span><br><span class="line"></span><br><span class="line">#删除触发器</span><br><span class="line">drop trigger tb_user_update_trigger;</span><br></pre></td></tr></table></figure>

<h4 id="drop类型"><a href="#drop类型" class="headerlink" title="drop类型"></a>drop类型</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create trigger tb_user_insert_trigger</span><br><span class="line">							   #行级触发器</span><br><span class="line">	after insert on tb_user for each row</span><br><span class="line">begin</span><br><span class="line"></span><br><span class="line">	insert into user_Logs(id,operation,operate_time,operate_id,operate_params) VALUES</span><br><span class="line"></span><br><span class="line">	(null,&#x27;delete&#x27;,now(),new.id,</span><br><span class="line">		concat(&#x27;删除之前的数据内容为: id=&#x27;old.id,&#x27;,name=&#x27;old.name,&#x27;,phone=&#x27;,old.phone,&#x27;,email=&#x27;,old.email,&#x27;,profession=&#x27;,old.profession));</span><br><span class="line">	</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">#查看触发器</span><br><span class="line">show triggers;</span><br><span class="line"></span><br><span class="line">delete from tb_user where id=26;</span><br><span class="line"></span><br><span class="line">#删除触发器</span><br><span class="line">drop trigger tb_user_delete_trigger;</span><br></pre></td></tr></table></figure>

<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907185603359.png" alt="image-20240907185603359"></p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907185909132.png" alt="image-20240907185909132"></p>
<h3 id="锁的分类"><a href="#锁的分类" class="headerlink" title="锁的分类"></a>锁的分类</h3><ul>
<li>全局锁：锁定数据库中的所有表。</li>
<li>表级锁：每次操作锁住整张表。</li>
<li>行级锁：每次操作锁住对应的行数据。</li>
</ul>
<h4 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h4><p>一般用作数据备份时，只能读，不能写</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907190453962.png" alt="image-20240907190453962"></p>
<p>对当前数据库实例加全局锁</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flush tables with read lock;</span><br></pre></td></tr></table></figure>

<p>把数据库数据备份，存到sql文件中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#在cmd运行即可</span><br><span class="line">mysqldump -uroot -p hhh &gt; D://sql/hhh.sql</span><br></pre></td></tr></table></figure>

<p>解全局锁</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>

<h5 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907192209540.png" alt="image-20240907192209540"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqldump --single-transaction -uroot hhh&gt;hhh.sql</span><br></pre></td></tr></table></figure>

<h4 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907192358453.png" alt="image-20240907192358453"></p>
<h5 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h5><ul>
<li><p>表锁</p>
<ol>
<li><p>表共享读锁</p>
<p>加锁后所有客户端只可以读取，不能修改。</p>
</li>
<li><p>表读者写锁</p>
<p>加锁后，只有主客户端只可以读取修改，其他客户端不可以读取修改。</p>
</li>
</ol>
<h6 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h6><p>加锁</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lock tables [表名] read/write;</span><br></pre></td></tr></table></figure>

<p>解锁</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lock tables;</span><br></pre></td></tr></table></figure>
</li>
<li><p>元数据锁</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907193626192.png" alt="image-20240907193626192"></p>
</li>
<li><p>意向锁</p>
<p>二者兼容则加锁，否则阻塞</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907194409320.png" alt="image-20240907194409320"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907194643645.png" alt="image-20240907194643645"></p>
<p>添加行共享锁和对score表添加意向共享锁</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from score where id = 1 lock in share mode;</span><br></pre></td></tr></table></figure>

<p>查询状态</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from performance_schema.data_locks;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907195543174.png" alt="image-20240907195543174"></p>
<ul>
<li><p>行锁</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907202135603.png" alt="image-20240907202135603"></p>
<p>常见的操作所进行的行锁</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907195912693.png" alt="image-20240907195912693"></p>
<p>演示</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907201933931.png" alt="image-20240907201933931"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查询状态</span><br><span class="line">select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from performance_schema.data_locks;</span><br></pre></td></tr></table></figure>
</li>
<li><p>间隙锁</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907214632099.png" alt="image-20240907214632099"></p>
</li>
<li><p>临键锁</p>
</li>
</ul>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240907214914111.png" alt="image-20240907214914111"></p>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><h3 id="结构-逻辑结构"><a href="#结构-逻辑结构" class="headerlink" title="结构-逻辑结构"></a>结构-逻辑结构</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909192800318.png" alt="image-20240909192800318"></p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><h4 id="内存框架"><a href="#内存框架" class="headerlink" title="内存框架"></a>内存框架</h4><h5 id="Buffer-Pool缓冲池"><a href="#Buffer-Pool缓冲池" class="headerlink" title="Buffer Pool缓冲池"></a>Buffer Pool缓冲池</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909193248245.png" alt="image-20240909193248245"></p>
<h5 id="Change-Buffer"><a href="#Change-Buffer" class="headerlink" title="Change Buffer"></a>Change Buffer</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909193458927.png" alt="image-20240909193458927"></p>
<h5 id="Adaptive-Hash-Index-自适应哈希索引"><a href="#Adaptive-Hash-Index-自适应哈希索引" class="headerlink" title="Adaptive Hash Index(自适应哈希索引)"></a>Adaptive Hash Index(自适应哈希索引)</h5><p>InnoDB引擎使用B+树的索引，但是哈希索引也有很大优点</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909193920649.png" alt="image-20240909193920649"></p>
<p>查看参数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables likes &#x27;%hash_index%&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="Log-Buffer"><a href="#Log-Buffer" class="headerlink" title="Log Buffer"></a>Log Buffer</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909194225204.png" alt="image-20240909194225204"></p>
<p>查看参数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables likes &#x27;%log_buffer_size%&#x27;;</span><br><span class="line">show variables likes &#x27;%flush_log%&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="磁盘框架"><a href="#磁盘框架" class="headerlink" title="磁盘框架"></a>磁盘框架</h4><ul>
<li><h4 id="System-Tablespaces"><a href="#System-Tablespaces" class="headerlink" title="System Tablespaces"></a>System Tablespaces</h4><p>系统表空间</p>
</li>
<li><h4 id="File-Per-Table-Tablespaces"><a href="#File-Per-Table-Tablespaces" class="headerlink" title="File-Per-Table Tablespaces"></a>File-Per-Table Tablespaces</h4><p>每个表的文件表包含单个InnoDB表的数据和索引，并存储再文件系统上的单个数据文件中</p>
</li>
<li><h4 id="General-Tablespaces"><a href="#General-Tablespaces" class="headerlink" title="General Tablespaces"></a>General Tablespaces</h4><p>通用表空间</p>
</li>
<li><h4 id="Undo-Tablespaces"><a href="#Undo-Tablespaces" class="headerlink" title="Undo Tablespaces"></a>Undo Tablespaces</h4><p>撤销表空间</p>
</li>
<li><h4 id="Temporary-Tablespaces"><a href="#Temporary-Tablespaces" class="headerlink" title="Temporary Tablespaces"></a>Temporary Tablespaces</h4><p>临时表空间</p>
</li>
<li><h4 id="Doublewrite-Buffer-Files"><a href="#Doublewrite-Buffer-Files" class="headerlink" title="Doublewrite Buffer Files"></a>Doublewrite Buffer Files</h4><p>双写缓冲区</p>
</li>
<li><h4 id="Redo-Log"><a href="#Redo-Log" class="headerlink" title="Redo Log"></a>Redo Log</h4><p>重做日志</p>
</li>
</ul>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909194955994.png" alt="image-20240909194955994"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909195252449.png" alt="image-20240909195252449"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909195307954.png" alt="image-20240909195307954"></p>
<h4 id="后台线程"><a href="#后台线程" class="headerlink" title="后台线程"></a>后台线程</h4><p>查看InnoDB引擎的状态信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show engine innodb status;</span><br></pre></td></tr></table></figure>

<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909201504703.png" alt="image-20240909201504703"></p>
<h3 id="事务原理"><a href="#事务原理" class="headerlink" title="事务原理"></a>事务原理</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909201738679.png" alt="image-20240909201738679"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909201803360.png" alt="image-20240909201803360"></p>
<h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><ul>
<li><p>原子性</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909202707194.png" alt="image-20240909202707194"></p>
</li>
<li><p>持久性</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909202634034.png" alt="image-20240909202634034"></p>
</li>
<li><p>隔离性</p>
</li>
<li><p>一致性</p>
</li>
</ul>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909203058649.png" alt="image-20240909203058649"></p>
<p>一般情况下是重复读，添加了lock in share mode可以读取最新的记录</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909202943614.png" alt="image-20240909202943614"></p>
<h4 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h4><h5 id="隐藏字段"><a href="#隐藏字段" class="headerlink" title="隐藏字段"></a>隐藏字段</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909203511831.png" alt="image-20240909203511831"></p>
<p>查看表空间文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ibd2sdi stu.ibd</span><br></pre></td></tr></table></figure>

<h5 id="undo-log版本链"><a href="#undo-log版本链" class="headerlink" title="undo log版本链"></a>undo log版本链</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909204630061.png" alt="image-20240909204630061"></p>
<h5 id="readview"><a href="#readview" class="headerlink" title="readview"></a>readview</h5><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909204918657.png" alt="image-20240909204918657"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909205145374.png" alt="image-20240909205145374"></p>
<p>事务读取</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240909205752583.png" alt="image-20240909205752583"></p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910163034923.png" alt="image-20240910163034923"></p>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910163111038.png" alt="image-20240910163111038"></p>
<h2 id="MySQL管理"><a href="#MySQL管理" class="headerlink" title="MySQL管理"></a>MySQL管理</h2><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910163447650.png" alt="image-20240910163447650"></p>
<h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><h4 id="mysql客户端工具"><a href="#mysql客户端工具" class="headerlink" title="mysql客户端工具"></a>mysql客户端工具</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910163630065.png" alt="image-20240910163630065"></p>
<h4 id="mysqladmin"><a href="#mysqladmin" class="headerlink" title="mysqladmin"></a>mysqladmin</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910163835995.png" alt="image-20240910163835995"></p>
<h4 id="mysqlbinlog"><a href="#mysqlbinlog" class="headerlink" title="mysqlbinlog"></a>mysqlbinlog</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910170915811.png" alt="image-20240910170915811"></p>
<h4 id="mysqlshow"><a href="#mysqlshow" class="headerlink" title="mysqlshow"></a>mysqlshow</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910171104694.png" alt="image-20240910171104694"></p>
<h4 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910171140271.png" alt="image-20240910171140271"></p>
<h4 id="mysqlimport-source"><a href="#mysqlimport-source" class="headerlink" title="mysqlimport&#x2F;source"></a>mysqlimport&#x2F;source</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910171451190.png" alt="image-20240910171451190"></p>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910180635748.png" alt="image-20240910180635748"></p>
<h2 id="进阶篇总结"><a href="#进阶篇总结" class="headerlink" title="进阶篇总结"></a>进阶篇总结</h2><p>其中索引为重中之重</p>
<p><img src="/img/laze.gif" data-original="/img/MySQL/image-20240910180916750.png" alt="image-20240910180916750"></p>
<p>注明：至此进阶篇已完结，本学习分享大部分记录了本人学习<a target="_blank" rel="noopener" href="https://www.itcast.cn/">黑马程序员</a>MySQL系列课程的笔记，主要便于个人复习，也希望能给各位带来帮助，如有任何不足之处请指正！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://youyuanhui123.github.io">Xi17g3</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://youyuanhui123.github.io/2024/09/10/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%BA%8C-%E8%BF%9B%E9%98%B6%E7%AF%87/">http://youyuanhui123.github.io/2024/09/10/MySQL从安装到精通-二-进阶篇/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://youyuanhui123.github.io" target="_blank">园游会</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/Xi17g3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/laze.gif" data-original="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/laze.gif" data-original="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/2024/09/10/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%B8%89-%E8%BF%90%E7%BB%B4%E7%AF%87/" title="MySQL从安装到精通(三)---运维篇"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL从安装到精通(三)---运维篇</div></div></a><a class="next-post pull-right" href="/2024/08/23/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%B8%80-%E5%9F%BA%E7%A1%80%E7%AF%87/" title="MySQL从安装到精通(一)---基础篇"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL从安装到精通(一)---基础篇</div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src="/img/laze.gif" data-original="/img/Xi17g3.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Xi17g3</div><div class="author-info-description">琥珀色黄昏像糖在很美的远方</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/youyuanhui123"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://youyuanhui123/github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/2301_80708520" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1469443539&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:1469443539@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E8%BF%9B%E9%98%B6%E7%AF%87"><span class="toc-text">(二)进阶篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#By-Xi17g3"><span class="toc-text">By Xi17g3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-text">MySQL体系结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%82%A8%E5%AD%98%E5%BC%95%E6%93%8E"><span class="toc-text">储存引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E5%B8%B8%E8%A7%81%E5%BC%95%E6%93%8E%E7%9A%84%E7%89%B9%E7%82%B9%EF%BC%9A"><span class="toc-text">三种常见引擎的特点：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#InnoDB"><span class="toc-text">InnoDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyISAM"><span class="toc-text">MyISAM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Memory"><span class="toc-text">Memory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E5%BC%95%E6%93%8E%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">三种引擎的区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E9%85%8D%E7%BD%AEMySQL"><span class="toc-text">Linux配置MySQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-key"><span class="toc-text">索引(key)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0"><span class="toc-text">索引概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-text">索引结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#B-Trees"><span class="toc-text">B-Trees</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#B-Trees-1"><span class="toc-text">B+Trees</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash"><span class="toc-text">Hash</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-text">索引分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-text">索引语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-text">SQL性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%89%A7%E8%A1%8C%E9%A2%91%E7%8E%87"><span class="toc-text">SQL执行频率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">慢查询日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#profile%E8%AF%A6%E6%83%85"><span class="toc-text">profile详情</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#explain%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-text">explain执行计划</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8"><span class="toc-text">索引使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%B4%A2%E5%BC%95%E6%95%88%E7%8E%87"><span class="toc-text">验证索引效率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E5%AD%97%E6%AE%B5%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">针对字段创建索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span class="toc-text">最左前缀法则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="toc-text">索引失效</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-text">范围查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%97%E8%BF%90%E7%AE%97"><span class="toc-text">索引列运算</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8D%E5%8A%A0%E5%BC%95%E5%8F%B7"><span class="toc-text">字符串不加引号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-text">模糊查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#or%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-text">or连接的条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E5%BD%B1%E5%93%8D"><span class="toc-text">数据分布影响</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%8F%90%E7%A4%BA"><span class="toc-text">SQL提示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95-%E5%9B%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">覆盖索引&amp;回表查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-text">前缀索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95%E4%B8%8E%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-text">单列索引与联合索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-text">索引设计原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96"><span class="toc-text">SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#insert%E4%BC%98%E5%8C%96"><span class="toc-text">insert优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-text">主键优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by%E4%BC%98%E5%8C%96"><span class="toc-text">order by优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group-by%E4%BC%98%E5%8C%96"><span class="toc-text">group by优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#limit%E4%BC%98%E5%8C%96"><span class="toc-text">limit优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count%E4%BC%98%E5%8C%96"><span class="toc-text">count优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update%E4%BC%98%E5%8C%96-%E9%81%BF%E5%85%8D%E8%A1%8C%E9%94%81"><span class="toc-text">update优化(避免行锁)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">视图&#x2F;存储过程&#x2F;触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%80%89%E9%A1%B9"><span class="toc-text">检查选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8F%8A%E4%BD%9C%E7%94%A8"><span class="toc-text">更新及作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-text">特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-text">变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-text">系统变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="toc-text">用户变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-text">局部变量</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#if%E5%88%A4%E6%96%AD"><span class="toc-text">if判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-text">参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case"><span class="toc-text">case</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF"><span class="toc-text">循环</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#while"><span class="toc-text">while</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#repeat"><span class="toc-text">repeat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#loop"><span class="toc-text">loop</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-text">游标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-text">条件处理程序</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-text">存储函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#insert%E7%B1%BB%E5%9E%8B"><span class="toc-text">insert类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update%E7%B1%BB%E5%9E%8B"><span class="toc-text">update类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#drop%E7%B1%BB%E5%9E%8B"><span class="toc-text">drop类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81"><span class="toc-text">锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">锁的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-text">全局锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-text">表级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-text">分类</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-1"><span class="toc-text">语法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-text">行级锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB%E5%BC%95%E6%93%8E"><span class="toc-text">InnoDB引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84-%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84"><span class="toc-text">结构-逻辑结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-text">架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%A1%86%E6%9E%B6"><span class="toc-text">内存框架</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Buffer-Pool%E7%BC%93%E5%86%B2%E6%B1%A0"><span class="toc-text">Buffer Pool缓冲池</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Change-Buffer"><span class="toc-text">Change Buffer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Adaptive-Hash-Index-%E8%87%AA%E9%80%82%E5%BA%94%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95"><span class="toc-text">Adaptive Hash Index(自适应哈希索引)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Log-Buffer"><span class="toc-text">Log Buffer</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E6%A1%86%E6%9E%B6"><span class="toc-text">磁盘框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#System-Tablespaces"><span class="toc-text">System Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#File-Per-Table-Tablespaces"><span class="toc-text">File-Per-Table Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#General-Tablespaces"><span class="toc-text">General Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Undo-Tablespaces"><span class="toc-text">Undo Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Temporary-Tablespaces"><span class="toc-text">Temporary Tablespaces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Doublewrite-Buffer-Files"><span class="toc-text">Doublewrite Buffer Files</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redo-Log"><span class="toc-text">Redo Log</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B"><span class="toc-text">后台线程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86"><span class="toc-text">事务原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-text">特性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MVCC"><span class="toc-text">MVCC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E5%AD%97%E6%AE%B5"><span class="toc-text">隐藏字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#undo-log%E7%89%88%E6%9C%AC%E9%93%BE"><span class="toc-text">undo log版本链</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#readview"><span class="toc-text">readview</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E7%AE%A1%E7%90%86"><span class="toc-text">MySQL管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">系统数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-text">常用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7"><span class="toc-text">mysql客户端工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysqladmin"><span class="toc-text">mysqladmin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysqlbinlog"><span class="toc-text">mysqlbinlog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysqlshow"><span class="toc-text">mysqlshow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysqldump"><span class="toc-text">mysqldump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysqlimport-source"><span class="toc-text">mysqlimport&#x2F;source</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E7%AF%87%E6%80%BB%E7%BB%93"><span class="toc-text">进阶篇总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/10/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%B8%89-%E8%BF%90%E7%BB%B4%E7%AF%87/" title="MySQL从安装到精通(三)---运维篇">MySQL从安装到精通(三)---运维篇</a><time datetime="2024-09-10T10:25:36.000Z" title="发表于 2024-09-10 18:25:36">2024-09-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/10/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%BA%8C-%E8%BF%9B%E9%98%B6%E7%AF%87/" title="MySQL从安装到精通(二)---进阶篇">MySQL从安装到精通(二)---进阶篇</a><time datetime="2024-09-10T10:25:12.000Z" title="发表于 2024-09-10 18:25:12">2024-09-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/23/MySQL%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E7%B2%BE%E9%80%9A-%E4%B8%80-%E5%9F%BA%E7%A1%80%E7%AF%87/" title="MySQL从安装到精通(一)---基础篇">MySQL从安装到精通(一)---基础篇</a><time datetime="2024-08-23T13:46:56.000Z" title="发表于 2024-08-23 21:46:56">2024-08-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By Xi17g3</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>